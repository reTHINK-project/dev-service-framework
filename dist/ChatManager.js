// version: 0.9.1
// date: Mon Aug 20 2018 14:49:45 GMT+0100 (Western European Summer Time)
// licence: 
/**
* Copyright 2016 PT Inovação e Sistemas SA
* Copyright 2016 INESC-ID
* Copyright 2016 QUOBIS NETWORKS SL
* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V
* Copyright 2016 ORANGE SA
* Copyright 2016 Deutsche Telekom AG
* Copyright 2016 Apizee
* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
**/


!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ChatManager",[],t):"object"==typeof exports?exports.ChatManager=t():(e[""]=e[""]||{},e[""].ChatManager=t())}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=164)}([function(e,t){var n=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=n)},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){var r=n(28)("wks"),o=n(21),i=n(1).Symbol,a="function"==typeof i;(e.exports=function(e){return r[e]||(r[e]=a&&i[e]||(a?i:o)("Symbol."+e))}).store=r},function(e,t,n){e.exports=!n(10)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(1),o=n(0),i=n(14),a=n(8),s=n(9),c=function(e,t,n){var u,l,f,d=e&c.F,v=e&c.G,h=e&c.S,p=e&c.P,y=e&c.B,b=e&c.W,g=v?o:o[t]||(o[t]={}),_=g.prototype,m=v?r:h?r[t]:(r[t]||{}).prototype;v&&(n=t);for(u in n)(l=!d&&m&&void 0!==m[u])&&s(g,u)||(f=l?m[u]:n[u],g[u]=v&&"function"!=typeof m[u]?n[u]:y&&l?i(f,r):b&&m[u]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(f):p&&"function"==typeof f?i(Function.call,f):f,p&&((g.virtual||(g.virtual={}))[u]=f,e&c.R&&_&&!_[u]&&a(_,u,f)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(5);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var r=n(6),o=n(32),i=n(24),a=Object.defineProperty;t.f=n(3)?Object.defineProperty:function(e,t,n){if(r(e),t=i(t,!0),r(n),o)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(7),o=n(17);e.exports=n(3)?function(e,t,n){return r.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(54),o=n(25);e.exports=function(e){return r(o(e))}},function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(51),o=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t,n){var r=n(20);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=!0},function(e,t){e.exports={}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(37),o=n(29);e.exports=Object.keys||function(e){return r(e,o)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t,n){var r=n(7).f,o=n(9),i=n(2)("toStringTag");e.exports=function(e,t,n){e&&!o(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},function(e,t,n){var r=n(5),o=n(1).document,i=r(o)&&r(o.createElement);e.exports=function(e){return i?o.createElement(e):{}}},function(e,t,n){var r=n(5);e.exports=function(e,t){if(!r(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(28)("keys"),o=n(21);e.exports=function(e){return r[e]||(r[e]=o(e))}},function(e,t,n){var r=n(0),o=n(1),i=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(15)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(25);e.exports=function(e){return Object(r(e))}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){e.exports=!n(3)&&!n(10)(function(){return 7!=Object.defineProperty(n(23)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(6),o=n(72),i=n(29),a=n(27)("IE_PROTO"),s=function(){},c=function(){var e,t=n(23)("iframe"),r=i.length;for(t.style.display="none",n(48).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;r--;)delete c.prototype[i[r]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[a]=e):n=c(),void 0===t?n:o(n,t)}},,,,function(e,t,n){var r=n(9),o=n(11),i=n(64)(!1),a=n(27)("IE_PROTO");e.exports=function(e,t){var n,s=o(e),c=0,u=[];for(n in s)n!=a&&r(s,n)&&u.push(n);for(;t.length>c;)r(s,n=t[c++])&&(~i(u,n)||u.push(n));return u}},function(e,t,n){"use strict";var r=n(15),o=n(4),i=n(45),a=n(8),s=n(16),c=n(71),u=n(22),l=n(49),f=n(2)("iterator"),d=!([].keys&&"next"in[].keys()),v=function(){return this};e.exports=function(e,t,n,h,p,y,b){c(n,t,h);var g,_,m,C=function(e){if(!d&&e in M)return M[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},O=t+" Iterator",w="values"==p,j=!1,M=e.prototype,R=M[f]||M["@@iterator"]||p&&M[p],x=R||C(p),L=p?w?C("entries"):x:void 0,U="Array"==t?M.entries||R:R;if(U&&(m=l(U.call(new e)))!==Object.prototype&&m.next&&(u(m,O,!0),r||"function"==typeof m[f]||a(m,f,v)),w&&R&&"values"!==R.name&&(j=!0,x=function(){return R.call(this)}),r&&!b||!d&&!j&&M[f]||a(M,f,x),s[t]=x,s[O]=v,p)if(g={values:w?x:C("values"),keys:y?x:C("keys"),entries:L},b)for(_ in g)_ in M||i(M,_,g[_]);else o(o.P+o.F*(d||j),t,g);return g}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(26),o=Math.min;e.exports=function(e){return e>0?o(r(e),9007199254740991):0}},,,function(e,t,n){"use strict";function r(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=o(t),this.reject=o(n)}var o=n(20);e.exports.f=function(e){return new r(e)}},function(e,t,n){var r=n(4),o=n(0),i=n(10);e.exports=function(e,t){var n=(o.Object||{})[e]||Object[e],a={};a[e]=t(n),r(r.S+r.F*i(function(){n(1)}),"Object",a)}},function(e,t,n){e.exports=n(8)},function(e,t,n){e.exports={default:n(100),__esModule:!0}},function(e,t,n){"use strict";var r=n(70)(!0);n(38)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){var r=n(1).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(9),o=n(30),i=n(27)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=o(e),r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,n){n(73);for(var r=n(1),o=n(8),i=n(16),a=n(2)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<s.length;c++){var u=s[c],l=r[u],f=l&&l.prototype;f&&!f[a]&&o(f,a,u),i[u]=i.Array}},function(e,t,n){e.exports={default:n(52),__esModule:!0}},function(e,t,n){n(53);var r=n(0).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){var r=n(4);r(r.S+r.F*!n(3),"Object",{defineProperty:n(7).f})},function(e,t,n){var r=n(18);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},,function(e,t){},function(e,t,n){var r,o;!function(i,a){"use strict";r=a,void 0!==(o="function"==typeof r?r.call(t,n,t,e):r)&&(e.exports=o)}(0,function(){"use strict";function e(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function t(t){return"debug"===t&&(t="log"),typeof console!==s&&(void 0!==console[t]?e(console,t):void 0!==console.log?e(console,"log"):a)}function n(e,t){for(var n=0;n<c.length;n++){var r=c[n];this[r]=n<e?a:this.methodFactory(r,e,t)}this.log=this.debug}function r(e,t,r){return function(){typeof console!==s&&(n.call(this,t,r),this[e].apply(this,arguments))}}function o(e,n,o){return t(e)||r.apply(this,arguments)}function i(e,t,r){function i(e){var t=(c[e]||"silent").toUpperCase();if(typeof window!==s){try{return void(window.localStorage[f]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(f)+"="+t+";"}catch(e){}}}function a(){var e;if(typeof window!==s){try{e=window.localStorage[f]}catch(e){}if(typeof e===s)try{var t=window.document.cookie,n=t.indexOf(encodeURIComponent(f)+"=");-1!==n&&(e=/^([^;]+)/.exec(t.slice(n))[1])}catch(e){}return void 0===l.levels[e]&&(e=void 0),e}}var u,l=this,f="loglevel";e&&(f+=":"+e),l.name=e,l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=r||o,l.getLevel=function(){return u},l.setLevel=function(t,r){if("string"==typeof t&&void 0!==l.levels[t.toUpperCase()]&&(t=l.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=l.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(u=t,!1!==r&&i(t),n.call(l,t,e),typeof console===s&&t<l.levels.SILENT)return"No console available for logging"},l.setDefaultLevel=function(e){a()||l.setLevel(e,!1)},l.enableAll=function(e){l.setLevel(l.levels.TRACE,e)},l.disableAll=function(e){l.setLevel(l.levels.SILENT,e)};var d=a();null==d&&(d=null==t?"WARN":t),l.setLevel(d,!1)}var a=function(){},s="undefined",c=["trace","debug","info","warn","error"],u=new i,l={};u.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=l[e];return t||(t=l[e]=new i(e,u.getLevel(),u.methodFactory)),t};var f=typeof window!==s?window.log:void 0;return u.noConflict=function(){return typeof window!==s&&window.log===u&&(window.log=f),u},u.getLoggers=function(){return l},u})},,,function(e,t,n){e.exports={default:n(78),__esModule:!0}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){function t(e){var t=/([a-zA-Z-]*)(:\/\/(?:\.)?|:)([-a-zA-Z0-9@:%._\+~#=]{2,256})([-a-zA-Z0-9@:%._\+~#=\/]*)/gi;return e.replace(t,"$1,$3,$4").split(",")}var n=t(e);if(n[0]===e&&!n[0].includes("@")){var r={type:"",domain:e,identity:""};return console.warn("[DivideURL] DivideURL don't support url without scheme. Please review your url address",e),r}if(n[0]===e&&n[0].includes("@")){n=t((n[0]===e?"smtp":n[0])+"://"+n[0])}return n[1].includes("@")&&(n[2]=n[0]+"://"+n[1],n[1]=n[1].substr(n[1].indexOf("@")+1)),{type:n[0],domain:n[1],identity:n[2]}}function i(e){var t=e.indexOf("@");return{username:e.substring(0,t),domain:e.substring(t+1,e.length)}}function a(e){return!((0,y.default)(e).length>0)}function s(e){if(e)return JSON.parse((0,h.default)(e))}function c(e){var t=e.indexOf("@");return"user://"+e.substring(t+1,e.length)+"/"+e.substring(0,t)}function u(e){var t=o(e);return t.identity.replace("/","")+"@"+t.domain}function l(e){if("user://"===e.substring(0,7)){var t=o(e);if(t.domain&&t.identity)return e;throw"userURL with wrong format"}return c(e)}function f(e){var t=/((([a-zA-Z]+):\/\/([0-9a-zA-Z][-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9})\/[a-zA-Z0-9\.]+@[a-zA-Z0-9]+(\-)?[a-zA-Z0-9]+(\.)?[a-zA-Z0-9]{2,10}?\.[a-zA-Z]{2,10})(.+(?=.identity))?/gm,n=[],r=[];if(null==e.match(t))r=e.split(".");else{for(var o=void 0;null!==(o=t.exec(e));)o.index===t.lastIndex&&t.lastIndex++,o.forEach(function(e,t){0===t&&n.push(e)});var i=void 0;n.forEach(function(t){i=e.replace(t,"*+*"),r=i.split(".").map(function(e){return"*+*"===e?t:e})})}return console.log("[ServiceFramework.Utils.checkAttribute]",r),r}function d(e){var t=/([0-9a-zA-Z][-\w]*):\/\//g;if(e.includes("://")){var n=e.split(t)[0],r=n.split("."),o=e.replace(n,"");if(e.includes("identity")){var i=o.split("identity.");console.log("array2 "+i),o=i[0].slice(".",-1),i=i[1].split("."),r.push(o,"identity"),r=r.concat(i)}else r.push(o);return r.filter(Boolean)}return e.split(".")}Object.defineProperty(t,"__esModule",{value:!0});var v=n(62),h=r(v),p=n(60),y=r(p);t.divideURL=o,t.divideEmail=i,t.emptyObject=a,t.deepClone=s,t.getUserURLFromEmail=c,t.getUserEmailFromURL=u,t.convertToUserURL=l,t.checkAttribute=f,t.parseAttributes=d},function(e,t,n){e.exports={default:n(76),__esModule:!0}},function(e,t,n){var r=n(18),o=n(2)("toStringTag"),i="Arguments"==r(function(){return arguments}()),a=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=a(t=Object(e),o))?n:i?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t,n){var r=n(11),o=n(40),i=n(65);e.exports=function(e){return function(t,n,a){var s,c=r(t),u=o(c.length),l=i(a,u);if(e&&n!=n){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===n)return e||l||0;return!e&&-1}}},function(e,t,n){var r=n(26),o=Math.max,i=Math.min;e.exports=function(e,t){return e=r(e),e<0?o(e+t,0):i(e,t)}},function(e,t,n){var r=n(6),o=n(20),i=n(2)("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||void 0==(n=r(a)[i])?t:o(n)}},function(e,t,n){var r,o,i,a=n(14),s=n(106),c=n(48),u=n(23),l=n(1),f=l.process,d=l.setImmediate,v=l.clearImmediate,h=l.MessageChannel,p=l.Dispatch,y=0,b={},g=function(){var e=+this;if(b.hasOwnProperty(e)){var t=b[e];delete b[e],t()}},_=function(e){g.call(e.data)};d&&v||(d=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return b[++y]=function(){s("function"==typeof e?e:Function(e),t)},r(y),y},v=function(e){delete b[e]},"process"==n(18)(f)?r=function(e){f.nextTick(a(g,e,1))}:p&&p.now?r=function(e){p.now(a(g,e,1))}:h?(o=new h,i=o.port2,o.port1.onmessage=_,r=a(i.postMessage,i,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",_,!1)):r="onreadystatechange"in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),g.call(e)}}:function(e){setTimeout(a(g,e,1),0)}),e.exports={set:d,clear:v}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var r=n(6),o=n(5),i=n(43);e.exports=function(e,t){if(r(e),o(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){var r=n(26),o=n(25);e.exports=function(e){return function(t,n){var i,a,s=String(o(t)),c=r(n),u=s.length;return c<0||c>=u?e?"":void 0:(i=s.charCodeAt(c),i<55296||i>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):i:e?s.slice(c,c+2):a-56320+(i-55296<<10)+65536)}}},function(e,t,n){"use strict";var r=n(33),o=n(17),i=n(22),a={};n(8)(a,n(2)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(a,{next:o(1,n)}),i(e,t+" Iterator")}},function(e,t,n){var r=n(7),o=n(6),i=n(19);e.exports=n(3)?Object.defineProperties:function(e,t){o(e);for(var n,a=i(t),s=a.length,c=0;s>c;)r.f(e,n=a[c++],t[n]);return e}},function(e,t,n){"use strict";var r=n(74),o=n(75),i=n(16),a=n(11);e.exports=n(38)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,o(1)):"keys"==t?o(0,n):"values"==t?o(0,e[n]):o(0,[n,e[n]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var r=n(0),o=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},,function(e,t,n){n(79),e.exports=n(0).Object.keys},function(e,t,n){var r=n(30),o=n(19);n(44)("keys",function(){return function(e){return o(r(e))}})},,,,,,,,,,,function(e,t,n){var r=n(63),o=n(2)("iterator"),i=n(16);e.exports=n(0).getIteratorMethod=function(e){if(void 0!=e)return e[o]||e["@@iterator"]||i[r(e)]}},,,,,,,,,,function(e,t,n){n(56),n(47),n(50),n(101),n(112),n(113),e.exports=n(0).Promise},function(e,t,n){"use strict";var r,o,i,a,s=n(15),c=n(1),u=n(14),l=n(63),f=n(4),d=n(5),v=n(20),h=n(102),p=n(103),y=n(66),b=n(67).set,g=n(107)(),_=n(43),m=n(68),C=n(108),O=n(69),w=c.TypeError,j=c.process,M=j&&j.versions,R=M&&M.v8||"",x=c.Promise,L="process"==l(j),U=function(){},S=o=_.f,E=!!function(){try{var e=x.resolve(1),t=(e.constructor={})[n(2)("species")]=function(e){e(U,U)};return(L||"function"==typeof PromiseRejectionEvent)&&e.then(U)instanceof t&&0!==R.indexOf("6.6")&&-1===C.indexOf("Chrome/66")}catch(e){}}(),k=function(e){var t;return!(!d(e)||"function"!=typeof(t=e.then))&&t},I=function(e,t){if(!e._n){e._n=!0;var n=e._c;g(function(){for(var r=e._v,o=1==e._s,i=0;n.length>i;)!function(t){var n,i,a,s=o?t.ok:t.fail,c=t.resolve,u=t.reject,l=t.domain;try{s?(o||(2==e._h&&A(e),e._h=1),!0===s?n=r:(l&&l.enter(),n=s(r),l&&(l.exit(),a=!0)),n===t.promise?u(w("Promise-chain cycle")):(i=k(n))?i.call(n,c,u):c(n)):u(r)}catch(e){l&&!a&&l.exit(),u(e)}}(n[i++]);e._c=[],e._n=!1,t&&!e._h&&P(e)})}},P=function(e){b.call(c,function(){var t,n,r,o=e._v,i=D(e);if(i&&(t=m(function(){L?j.emit("unhandledRejection",o,e):(n=c.onunhandledrejection)?n({promise:e,reason:o}):(r=c.console)&&r.error&&r.error("Unhandled promise rejection",o)}),e._h=L||D(e)?2:1),e._a=void 0,i&&t.e)throw t.v})},D=function(e){return 1!==e._h&&0===(e._a||e._c).length},A=function(e){b.call(c,function(){var t;L?j.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},T=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),I(t,!0))},H=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw w("Promise can't be resolved itself");(t=k(e))?g(function(){var r={_w:n,_d:!1};try{t.call(e,u(H,r,1),u(T,r,1))}catch(e){T.call(r,e)}}):(n._v=e,n._s=1,I(n,!1))}catch(e){T.call({_w:n,_d:!1},e)}}};E||(x=function(e){h(this,x,"Promise","_h"),v(e),r.call(this);try{e(u(H,this,1),u(T,this,1))}catch(e){T.call(this,e)}},r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},r.prototype=n(109)(x.prototype,{then:function(e,t){var n=S(y(this,x));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=L?j.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&I(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new r;this.promise=e,this.resolve=u(H,e,1),this.reject=u(T,e,1)},_.f=S=function(e){return e===x||e===a?new i(e):o(e)}),f(f.G+f.W+f.F*!E,{Promise:x}),n(22)(x,"Promise"),n(110)("Promise"),a=n(0).Promise,f(f.S+f.F*!E,"Promise",{reject:function(e){var t=S(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(s||!E),"Promise",{resolve:function(e){return O(s&&this===a?x:this,e)}}),f(f.S+f.F*!(E&&n(111)(function(e){x.all(e).catch(U)})),"Promise",{all:function(e){var t=this,n=S(t),r=n.resolve,o=n.reject,i=m(function(){var n=[],i=0,a=1;p(e,!1,function(e){var s=i++,c=!1;n.push(void 0),a++,t.resolve(e).then(function(e){c||(c=!0,n[s]=e,--a||r(n))},o)}),--a||r(n)});return i.e&&o(i.v),n.promise},race:function(e){var t=this,n=S(t),r=n.reject,o=m(function(){p(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return o.e&&r(o.v),n.promise}})},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(14),o=n(104),i=n(105),a=n(6),s=n(40),c=n(90),u={},l={},t=e.exports=function(e,t,n,f,d){var v,h,p,y,b=d?function(){return e}:c(e),g=r(n,f,t?2:1),_=0;if("function"!=typeof b)throw TypeError(e+" is not iterable!");if(i(b)){for(v=s(e.length);v>_;_++)if((y=t?g(a(h=e[_])[0],h[1]):g(e[_]))===u||y===l)return y}else for(p=b.call(e);!(h=p.next()).done;)if((y=o(p,g,h.value,t))===u||y===l)return y};t.BREAK=u,t.RETURN=l},function(e,t,n){var r=n(6);e.exports=function(e,t,n,o){try{return o?t(r(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&r(i.call(e)),t}}},function(e,t,n){var r=n(16),o=n(2)("iterator"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||i[o]===e)}},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(1),o=n(67).set,i=r.MutationObserver||r.WebKitMutationObserver,a=r.process,s=r.Promise,c="process"==n(18)(a);e.exports=function(){var e,t,n,u=function(){var r,o;for(c&&(r=a.domain)&&r.exit();e;){o=e.fn,e=e.next;try{o()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(c)n=function(){a.nextTick(u)};else if(!i||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);n=function(){l.then(u)}}else n=function(){o.call(r,u)};else{var f=!0,d=document.createTextNode("");new i(u).observe(d,{characterData:!0}),n=function(){d.data=f=!f}}return function(r){var o={fn:r,next:void 0};t&&(t.next=o),e||(e=o,n()),t=o}}},function(e,t,n){var r=n(1),o=r.navigator;e.exports=o&&o.userAgent||""},function(e,t,n){var r=n(8);e.exports=function(e,t,n){for(var o in t)n&&e[o]?e[o]=t[o]:r(e,o,t[o]);return e}},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(7),a=n(3),s=n(2)("species");e.exports=function(e){var t="function"==typeof o[e]?o[e]:r[e];a&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r=n(2)("iterator"),o=!1;try{var i=[7][r]();i.return=function(){o=!0},Array.from(i,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var n=!1;try{var i=[7],a=i[r]();a.next=function(){return{done:n=!0}},i[r]=function(){return a},e(i)}catch(e){}return n}},function(e,t,n){"use strict";var r=n(4),o=n(0),i=n(1),a=n(66),s=n(69);r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,o.Promise||i.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then(function(){return n})}:e,n?function(n){return s(t,e()).then(function(){throw n})}:e)}})},function(e,t,n){"use strict";var r=n(4),o=n(43),i=n(68);r(r.S,"Promise",{try:function(e){var t=o.f(this),n=i(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},,function(e,t,n){e.exports={default:n(116),__esModule:!0}},function(e,t,n){n(117),e.exports=n(0).Object.assign},function(e,t,n){var r=n(4);r(r.S+r.F,"Object",{assign:n(118)})},function(e,t,n){"use strict";var r=n(19),o=n(39),i=n(31),a=n(30),s=n(54),c=Object.assign;e.exports=!c||n(10)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=r})?function(e,t){for(var n=a(e),c=arguments.length,u=1,l=o.f,f=i.f;c>u;)for(var d,v=s(arguments[u++]),h=l?r(v).concat(l(v)):r(v),p=h.length,y=0;p>y;)f.call(v,d=h[y++])&&(n[d]=v[d]);return n}:c},,,,,,,,function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(60),i=r(o),a=n(46),s=r(a),c=n(12),u=r(c),l=n(13),f=r(l),d=n(57),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(d),h=n(61),p=v.getLogger("RegistrationStatus"),y=function(){function e(t,n,r,o){(0,u.default)(this,e),this._registryObjectURL=t,this._runtimeURL=n,this._domain=(0,h.divideURL)(n).domain,this._discoveredObjectURL=r,this._messageBus=o,this._subscriptionSet=!1,this._subscribers={live:{},disconnected:{}}}return(0,f.default)(e,[{key:"onLive",value:function(e,t){var n=this;return new s.default(function(r,o){n._subscriptionSet?(n._subscribers.live[e]=t,r()):n._subscribe().then(function(){n._subscribers.live[e]=t,r()}).catch(function(e){return o(e)})})}},{key:"onDisconnected",value:function(e,t){var n=this;return new s.default(function(r,o){n._subscriptionSet?(n._subscribers.disconnected[e]=t,r()):n._subscribe().then(function(){n._subscribers.disconnected[e]=t,r()}).catch(function(e){return o(e)})})}},{key:"_subscribe",value:function(){var e=this,t={type:"subscribe",from:this._discoveredObjectURL,to:this._runtimeURL+"/subscriptions",body:{resources:[this._registryObjectURL+"/registration"]}};return new s.default(function(n,r){e._messageBus.postMessage(t,function(t){p.log("[DiscoveredObject.subscribe] "+e._registryObjectURL+" rcved reply ",t),200===t.body.code?(e._generateListener(e._registryObjectURL+"/registration"),e._subscriptionSet=!0,n()):(p.error("Error subscribing ",e._registryObjectURL),r("Error subscribing "+e._registryObjectURL))})})}},{key:"_generateListener",value:function(e){var t=this;this._messageBus.addListener(e,function(e){p.log("[DiscoveredObject.notification] "+t._registryObjectURL+": ",e),t._processNotification(e)})}},{key:"_processNotification",value:function(e){var t=this,n=e.body.value;setTimeout(function(){(0,i.default)(t._subscribers[n]).forEach(function(e){return t._subscribers[n][e]()})},5e3)}},{key:"_unsubscribe",value:function(){var e=this,t={type:"unsubscribe",from:this._discoveredObjectURL,to:this._runtimeURL+"/subscriptions",body:{resource:this._registryObjectURL+"/registration"}};return new s.default(function(n,r){e._messageBus.postMessage(t,function(t){p.log("[DiscoveredObject.unsubscribe] "+e._registryObjectURL+" rcved reply ",t),200===t.body.code?n():(p.error("Error unsubscribing ",e._registryObjectURL),r("Error unsubscribing "+e._registryObjectURL))})})}},{key:"unsubscribeLive",value:function(e){var t=this;return new s.default(function(n,r){e in t._subscribers.live&&delete t._subscribers.live[e],t._areSubscriptionsEmpty()?t._unsubscribe().then(function(){return n()}).catch(function(e){return r(e)}):n()})}},{key:"unsubscribeDisconnected",value:function(e){var t=this;return new s.default(function(n,r){e in t._subscribers.disconnected?(delete t._subscribers.disconnected[e],t._areSubscriptionsEmpty()?t._unsubscribe().then(function(){return n()}).catch(function(e){return r(e)}):n()):r(e+" doesn't subscribe onDisconnected for "+t._registryObjectURL)})}},{key:"_areSubscriptionsEmpty",value:function(){return 0===(0,i.default)(this._subscribers.live).length&&0===(0,i.default)(this._subscribers.disconnected).length}}]),e}();t.default=y,e.exports=t.default},,,,,,,,,,,,,,,function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(46),i=r(o),a=n(62),s=r(a),c=n(12),u=r(c),l=n(13),f=r(l),d=n(126),v=r(d),h=n(167),p=r(h),y=function(){function e(t,n,r,o,i,a){if((0,u.default)(this,e),!t)throw Error("Syncher is a necessary dependecy");if(!n)throw Error("Discover is a necessary dependecy");if(!r)throw Error("Domain is a necessary dependecy");if(!o)throw Error("Search is a necessary dependecy");var s=this;s._syncher=t,s.discovery=n,s.search=o,s.myIdentity=i,s.controllerMode="reporter",s.child_cseq=0,s.domain=r,s._manager=a;var c=t.owner;s._objectDescURL="hyperty-catalogue://catalogue."+r+"/.well-known/dataschema/Communication",s._invitationsHandler=new p.default(c)}return(0,f.default)(e,[{key:"_setOnAddChildListener",value:function(e){var t=this;e.onAddChild(function(e){t.child_cseq+=1,console.info("[ChatManager.ChatController._setOnAddChildListener] new Child received: ",e),t._onMessage&&t._onMessage(e)})}},{key:"_onSubscribe",value:function(e){var t=this._dataObjectReporter;e.accept(),console.log("[ChatManager.ChatController.onSubscribe] event",e,t.url),console.log("[ChatManager.ChatController.onSubscribe] New user has subscribe this object: ",t.data,e.identity);var n=JSON.parse((0,s.default)(e.identity));n.hasOwnProperty("assertion")&&delete n.assertion;var r={hypertyURL:e.url,domain:e.domain,identity:n},o=e.identity.userProfile.userURL;console.log("[ChatManager.ChatController.onSubscribe]  new participant",r),e.identity.legacy&&(r.legacy=e.identity.legacy),t.data.participants[o]=r,console.log("[ChatManager.ChatController.onSubscribe] communicationObject OBJ chatcontroller",t.data.participants),console.log("[ChatManager.ChatController.onSubscribe - onSubscription] ",r),this._onUserAdded&&this._onUserAdded(r)}},{key:"_onUnsubscribe",value:function(e){var t=this._dataObjectReporter;console.log("[ChatManager.ChatController.onUnsubscribe] event",e,t.url);var n=e.identity.userProfile;console.log("[ChatManager.ChatController.onUnsubscribe]  participant left",n),e.identity.legacy&&(n.legacy=e.identity.legacy),delete t.data.participants[n.userURL],console.log("[ChatManager.ChatController.onUnsubscribe - this._onUserRemoved] ",this.onUserRemoved),this._onUserRemoved&&this._onUserRemoved(n)}},{key:"sendFile",value:function(e){var t=this,n=t.controllerMode,r="reporter"===n?t.dataObjectReporter:t.dataObjectObserver;return new i.default(function(n,o){var i={userProfile:t.myIdentity};r.addHypertyResource("resources","file",e,i).then(function(e){var o={userProfile:t.myIdentity},i={value:e,identity:o,resource:e},a=new v.default(r.url,t._manager._runtimeURL,t._manager._hypertyURL,t._manager._bus);!function e(t,r,o,i){var a=i;t.sharingStatus.then(n(o)).catch(function(n){console.log("[ChatManager.ChatController.sendFile] share failed: ",n),a.onLive(r,function(){a.unsubscribeLive(r),t.share(!0),e(t,r,o,a)})})}(e,t._manager._hypertyURL,i,a)})}).catch(function(e){console.error("Reason:",e),reject(e)})}},{key:"send",value:function(e,t){var n=this,r=n.controllerMode,o="reporter"===r?n.dataObjectReporter:n.dataObjectObserver;return new i.default(function(r,i){n.child_cseq+=1;var a={type:"chat",content:e},s=t||{userProfile:n.myIdentity};o.addChild("resources",a,s).then(function(e){console.log("[ChatManager.ChatController][addChild - Chat Message]: ",e);var t={childId:e._childId,from:e._owner,value:e.data,type:"create",identity:s},i=new v.default(o.url,n._manager._runtimeURL,n._manager._hypertyURL,n._manager._bus);!function e(t,n,o,i){var a=i;t.sharingStatus.then(r(o)).catch(function(r){a.onLive(n,function(){a.unsubscribeLive(n),t.share(!0),e(t,n,o,a)})})}(e,n._manager._hypertyURL,t,i)}).catch(function(e){console.error("Reason:",e),i(e)})})}},{key:"onChange",value:function(e){this._onChange=e}},{key:"onMessage",value:function(e){this._onMessage=e}},{key:"onUserAdded",value:function(e){this._onUserAdded=e}},{key:"onUserRemoved",value:function(e){this._onUserRemoved=e}},{key:"onClose",value:function(e){this._onClose=e}},{key:"onResponse",value:function(e){this._onResponse=e}},{key:"addUser",value:function(e){var t=this,n=function(e){return console.log("Element:",e.length),0!==e.length};return new i.default(function(r,o){if(0===e.filter(n).length)return o("Don't have users to invite");console.info("[ChatManager.ChatController.addUsers ]: ",e);var a=[],s=[],c={};e.forEach(function(e){var n=t.discovery.discoverHypertiesDO(e.user,["comm"],["chat"],e.domain);a.push(n)}),i.default.all(a).then(function(e){console.log("[ChatManager.ChatController.addUsers] Users Discovery Results->",e);var n=[];e.forEach(function(e){e.forEach(function(e){"live"===e.data.status?(n.push(e.data.hypertyID),c[e.data.hypertyID]=e):s.length<5&&s.push(e)})}),console.info("[ChatManager.ChatController]------------------------ Syncher Create ---------------------- \n"),console.info("[ChatManager.ChatController]Selected Hyperties: !!! ",n),console.info("Have "+n.length+" users;");var r="reporter"===t.controllerMode?t.dataObjectReporter:t.dataObjectObserver;s.length>0&&t._invitationsHandler.inviteDisconnectedHyperties(s,r),r.inviteObservers(n),r.invitations.length>0&&t._invitationsHandler.processInvitations(c,r)}).then(function(){console.info("[ChatManager.ChatController]Are invited with success "+e.length+" users;"),r(!0)}).catch(function(e){console.error("An error occurred when trying to invite users;\n",e),o(e)})})}},{key:"addUserReq",value:function(e){var t=this,n=function(e){return console.log("Element:",e.length),0!==e.length};return new i.default(function(r,o){if(0===e.filter(n).length)return o("[ChatManager.ChatController.addUserReq] Don't have users to add");if("observer"===!t.controllerMode){return o("[ChatManager.ChatController.addUserReq] only allowed to Chat Observer")}})}},{key:"onInvitationResponse",value:function(e){var t=this;t._onInvitationResponse=e,t._invitationsHandler.invitationResponse=e}},{key:"removeUser",value:function(e){console.log("[ChatManager.ChatController]Not yet implemented: ",e)}},{key:"close",value:function(){var e=this;return new i.default(function(t,n){if("reporter"===e.controllerMode)e._invitationsHandler.cleanInvitations(e.dataObjectReporter).then(function(){try{delete e._manager._reportersControllers[e.dataObjectReporter.url],e.dataObjectReporter.delete(),t(!0),e._onClose&&e._onClose({code:200,desc:"deleted",url:e.dataObjectReporter.url})}catch(e){console.error(e),n(!1)}});else try{delete e._manager._observersControllers[e.dataObjectObserver.url],e.dataObjectObserver.unsubscribe(),t(!0)}catch(e){console.error(e),n(!1)}})}},{key:"invitationsHandler",get:function(){return this._invitationsHandler}},{key:"url",get:function(){return"reporter"===this.controllerMode?this.dataObjectReporter.url:this.dataObjectObserver.url}},{key:"dataObjectReporter",set:function(e){if(!e)throw new Error("[ChatController] The data object reporter is necessary parameter ");var t=this;t.controllerMode="reporter",e.onSubscription(function(e){switch(e.type){case"subscribe":t._onSubscribe(e);break;case"unsubscribe":t._onUnsubscribe(e)}}),t._setOnAddChildListener(e),e.onRead(function(e){e.accept()}),e.onExecute(function(e){switch(e.method){case"addUser":t.addUser(e.params[0]).then(function(){e.accept()}).catch(function(t){console.error("Reason:",t),e.reject(t)});break;case"removeUser":t.removeUser(e.params).then(function(){e.accept()}).catch(function(t){console.error("Reason:",t),e.reject(t)});break;default:e.reject("[ChatController.onExecute] Chat method execution not accepted by Reporter")}}),t._dataObjectReporter=e},get:function(){return this._dataObjectReporter}},{key:"messages",get:function(){return"reporter"===this.controllerMode?this._dataObjectReporter._childrenObjects.resources:this._dataObjectObserver._childrenObjects.resources}},{key:"dataObjectObserver",set:function(e){var t=this;t.controllerMode="observer",t._dataObjectObserver=e,e.onChange("*",function(e){if(console.info("[ChatManager.ChatController]Observer - onChange",e),e.field.includes("participants"))switch(e.cType){case"add":t._onUserAdded&&t._onUserAdded(e);break;case"remove":t._onUserRemoved&&t._onUserRemoved(e)}t._onChange&&t._onChange(e)}),t._setOnAddChildListener(e)},get:function(){return this._dataObjectObserver}},{key:"dataObject",get:function(){return"reporter"===this.controllerMode?this.dataObjectReporter:this.dataObjectObserver}},{key:"closeEvent",set:function(e){var t=this;t._closeEvent=e,t._onClose&&t._onClose(e)},get:function(){return this._closeEvent}}]),e}();t.default=y,e.exports=t.default},,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ChatController=t.ChatManager=void 0;var o=n(165),i=r(o),a=n(141),s=r(a);t.ChatManager=i.default,t.ChatController=s.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(115),i=r(o),a=n(46),s=r(a),c=n(12),u=r(c),l=n(13),f=r(l),d=n(166),v=n(141),h=r(v),p=n(168),y=function(){function e(t,n,r,o,i){if((0,u.default)(this,e),!t)throw new Error("[ChatManager.constructor] The myUrl is a needed parameter");if(!n)throw new Error("[ChatManager.constructor] The MiniBus is a needed parameter");if(!r)throw new Error("[ChatManager.constructor] The configuration is a needed parameter");var a=this;i||(i=o.createSyncher(t,n,r)),a._runtimeURL=r.runtimeURL;var s=o.divideURL(a._runtimeURL).domain,c=o.createDiscovery(t,r.runtimeURL,n),l=o.createIdentityManager(t,r.runtimeURL,n);a._objectDescURL="hyperty-catalogue://catalogue."+s+"/.well-known/dataschema/Communication",a._reportersControllers={},a._observersControllers={},a._myUrl=t,a._bus=n,a._syncher=i,a._domain=s,a.discovery=c,a.identityManager=l,a.currentIdentity,a.search=o.createSearch(c,l),a.communicationObject=d.communicationObject,a.communicationChildren=d.communicationChildren,console.log("[ChatManager] Discover ",c),console.log("[ChatManager] Identity Manager ",l)}return(0,f.default)(e,[{key:"processNotification",value:function(e){var t=this;if(console.log("[ChatManager.processNotification: ",e),"create"===e.type&&t._onInvitation&&t._onInvitation(e),"delete"===e.type){e.ack(200),t._observersControllers[e.url].closeEvent=e,delete t._observersControllers[e.url],t._observersControllers.closeEvent=e,t.communicationObject=d.communicationObject;for(var n in this._reportersControllers)this._reportersControllers[n].closeEvent(e);for(var r in this._observersControllers)this._observersControllers[r].closeEvent(e)}}},{key:"myIdentity",value:function(e){var t=this;return new s.default(function(n,r){if(console.info("[ChatManager.myIdentity]"),e)return n(e);t._myUrl.includes("hyperty://")?t.identityManager.discoverUserRegistered().then(function(e){n(e)}).catch(function(e){r(e)}):t.identityManager.discoverIdentityPerIdP().then(function(e){n(e)}).catch(function(e){r(e)})})}},{key:"create",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this,o=r._syncher;return new s.default(function(a,c){r.communicationObject=d.communicationObject,r.communicationObject.cseq=1,r.communicationObject.startingTime=(new Date).toJSON(),r.communicationObject.status=d.CommunicationStatus.OPEN;var u=void 0;r.myIdentity().then(function(l){u=l,console.log("[ChatManager.create ] My Identity",l);var f=new p.UserInfo(r._myUrl,r._domain,l);r.communicationObject.participants[l.userURL]=f,console.log("[ChatManager.create ] participants: ",r.communicationObject.participants),console.log("[ChatManager.create ] communicationObject",r.communicationObject),console.info("[ChatManager.create] searching "+t);var d=[],v=[],y={};t.forEach(function(e){var t=r.discovery.discoverHypertiesDO(e.user,["comm"],["chat"],e.domain);d.push(t)}),s.default.all(d).then(function(t){console.log("[ChatManager.create] Users Discovery Results->",t);var a=[];t.forEach(function(e){e.forEach(function(e){"live"===e.data.status?(a.push(e.data.hypertyID),y[e.data.hypertyID]=e):v.length<5&&v.push(e)})}),console.info("[ChatManager] ---------------------- Syncher Create ---------------------- \n"),console.info("[ChatManager] Selected Hyperties: !!! ",a),console.info("Have "+a.length+" users;");var s=(0,i.default)({resources:["chat"],mutual:!0},n);return delete s.name,console.info("[ChatManager] input data:",s),o.create(r._objectDescURL,a,r.communicationObject,!0,!1,e,{},s)}).then(function(e){console.info("[ChatManager] 3. Return Create Data Object Reporter",e);var t=new h.default(o,r.discovery,r._domain,r.search,u,r);t.dataObjectReporter=e,r._reportersControllers[e.url]=t,console.log("[ChatManager] chatController invitationsHandler: ",t.invitationsHandler),e.invitations.length>0&&t.invitationsHandler.processInvitations(y,e),v.length>0&&t.invitationsHandler.inviteDisconnectedHyperties(v,e),a(t)}).catch(function(e){c(e)})}).catch(function(e){return console.log("[ChatManager.create] MyIdentity Error:",e),c(e)})})}},{key:"onInvitation",value:function(e){this._onInvitation=e}},{key:"join",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments[2],r=this;return new s.default(function(o,i){var a=r._syncher,s=void 0;console.info("[ChatManager] ------------------------ Syncher subscribe ---------------------- \n"),console.info("invitationURL",e),r.myIdentity(n).then(function(n){return s=n,a.subscribe(r._objectDescURL,e,!0,!1,t,n)}).then(function(e){console.info("Data Object Observer: ",e);var t=new h.default(a,r.discovery,r._domain,r.search,s,r);o(t),t.dataObjectObserver=e,r._observersControllers[e.url]=t}).catch(function(e){i(e)})})}}]),e}();t.default=y,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CommunicationStatus={OPEN:"open",PENDING:"pending",CLOSED:"closed",PAUSED:"paused",FAILED:"failed"},t.communicationObject={startingTime:"",status:"",participants:{}},t.communicationChildren={parent:"communication",listener:"resources",type:"HypertyResource"}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(60),i=r(o),a=n(46),s=r(a),c=n(12),u=r(c),l=n(13),f=r(l),d=function(){function e(t){if((0,u.default)(this,e),!t)throw Error("hypertyURL is a necessary dependecy");var n=this;n._hypertyURL=t,n._pending={}}return(0,f.default)(e,[{key:"inviteDisconnectedHyperties",value:function(e,t){var n=this;console.log("[GroupChatManager.InvitationsHandler.inviteDisconnectedHyperties] lets invite ",e),e.forEach(function(e){n._pending[t]||(n._pending[t]={}),n._pending[t][e.data.hypertyID]=e,e.onLive(n._hypertyURL,function(){console.log("[GroupChatManager.create] disconnected Hyperty is back to live",e),t.inviteObservers([e.data.hypertyID]),e.unsubscribeLive(n._hypertyURL),delete n._pending[t][e.data.hypertyID]})})}},{key:"processInvitations",value:function(e,t){var n=this,r=this,o=t.invitations||[];console.log("[GroupChatManager.InvitationsHandler.processInvitations] waiting for replies ",o,this._invitationsResponse),o.forEach(function(o){o.then(function(e){console.log("[GroupChatManager.InvitationsHandler.processInvitations] - OK: ",e,n._invitationsResponse),n._invitationsResponse&&n._invitationsResponse(e)}).catch(function(o){console.log("[GroupChatManager.InvitationsHandler.processInvitations] - NOT OK: ",o,n._invitationsResponse),n._invitationsResponse&&n._invitationsResponse(o),r.inviteDisconnectedHyperties([e[o.invited]],t)})})}},{key:"resumeDiscoveries",value:function(e,t){var n=this;return new s.default(function(r,o){var a={},c=[],u=[],l=[];e.resumeDiscoveries().then(function(e){console.log("[GroupChatManager.InvitationsHandler.resumeDiscoveries] found: ",e),e.forEach(function(e){e.data.resources&&"chat"===e.data.resources[0]&&(console.log("[GroupChatManager.InvitationsHandler.resumeDiscoveries] resuming: ",e),"live"===e.data.status?(a[e.data.hypertyID]=e,c.push(e.data.hypertyID),l.push(e.unsubscribeLive(n._hypertyURL))):u.push(e))}),u.length>0&&n.inviteDisconnectedHyperties(u,t),(0,i.default)(a).length>0?(t.inviteObservers(c),t.invitations.length>0&&n.processInvitations(a,t),s.default.all(l).then(function(){r()})):r()})}).catch(function(e){reject("[GroupChatManager.InvitationsHandler.resumeDiscoveries] failed | ",e)})}},{key:"cleanInvitations",value:function(e){var t=this,n=t._pending[e];return console.log("[GroupChatManager.InvitationsHandler.cleanInvitations] ",n),n?new s.default(function(e,r){var o=(0,i.default)(n),a=[];o.forEach(function(e){a.push(n[e].unsubscribeLive(t._hypertyURL))}),s.default.all(o).then(function(){e()})}):s.default.resolve()}},{key:"invitationResponse",set:function(e){this._invitationsResponse=e}}]),e}();t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UserInfo=void 0;var o=n(169),i=r(o),a=n(12),s=r(a),c=n(61);t.UserInfo=function e(t,n,r){var o;(0,s.default)(this,e);var a=(0,c.deepClone)(r);return r.hasOwnProperty("userProfile")||(a.userProfile=r),o={hypertyURL:t,domain:n},(0,i.default)(o,"domain",n),(0,i.default)(o,"identity",a),o}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(51),o=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(e,t,n){return t in e?(0,o.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}}])});